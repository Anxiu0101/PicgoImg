<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="516px" preserveAspectRatio="none" style="width:1116px;height:516px;background:#FFFFFF;" version="1.1" viewBox="0 0 1116 516" width="1116px" zoomAndPan="magnify"><defs><filter height="300%" id="fl2i8hobozrm8" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="40" lengthAdjust="spacing" textLength="190" x="459.75" y="53.5234">ChatRoom</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="22" x2="22" y1="153.9219" y2="430.7344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="98.5" x2="98.5" y1="153.9219" y2="430.7344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="520" x2="520" y1="153.9219" y2="430.7344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="705.5" x2="705.5" y1="153.9219" y2="430.7344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1015.5" x2="1015.5" y1="153.9219" y2="430.7344"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1081.5" x2="1081.5" y1="153.9219" y2="430.7344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="5" y="150.8457">user</text><ellipse cx="22" cy="79.3125" fill="#FEFECE" filter="url(#fl2i8hobozrm8)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M22,87.3125 L22,114.3125 M9,95.3125 L35,95.3125 M22,114.3125 L9,129.3125 M22,114.3125 L35,129.3125 " fill="none" filter="url(#fl2i8hobozrm8)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="5" y="444.2676">user</text><ellipse cx="22" cy="457.3438" fill="#FEFECE" filter="url(#fl2i8hobozrm8)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M22,465.3438 L22,492.3438 M9,473.3438 L35,473.3438 M22,492.3438 L9,507.3438 M22,492.3438 L35,507.3438 " fill="none" filter="url(#fl2i8hobozrm8)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fl2i8hobozrm8)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="47" x="73.5" y="117.3125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="80.5" y="138.8457">client</text><rect fill="#FEFECE" filter="url(#fl2i8hobozrm8)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="47" x="73.5" y="429.7344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="80.5" y="451.2676">client</text><rect fill="#FEFECE" filter="url(#fl2i8hobozrm8)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="54" x="491" y="117.3125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="498" y="138.8457">server</text><rect fill="#FEFECE" filter="url(#fl2i8hobozrm8)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="54" x="491" y="429.7344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="498" y="451.2676">server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="687.5" y="150.8457">redis</text><path d="M688,100.3125 C688,90.3125 706,90.3125 706,90.3125 C706,90.3125 724,90.3125 724,100.3125 L724,126.3125 C724,136.3125 706,136.3125 706,136.3125 C706,136.3125 688,136.3125 688,126.3125 L688,100.3125 " fill="#FEFECE" filter="url(#fl2i8hobozrm8)" style="stroke:#000000;stroke-width:1.5;"/><path d="M688,100.3125 C688,110.3125 706,110.3125 706,110.3125 C706,110.3125 724,110.3125 724,100.3125 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="687.5" y="444.2676">redis</text><path d="M688,457.3438 C688,447.3438 706,447.3438 706,447.3438 C706,447.3438 724,447.3438 724,457.3438 L724,483.3438 C724,493.3438 706,493.3438 706,493.3438 C706,493.3438 688,493.3438 688,483.3438 L688,457.3438 " fill="#FEFECE" filter="url(#fl2i8hobozrm8)" style="stroke:#000000;stroke-width:1.5;"/><path d="M688,457.3438 C688,467.3438 706,467.3438 706,467.3438 C706,467.3438 724,467.3438 724,457.3438 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="983.5" y="150.8457">database</text><path d="M998,100.3125 C998,90.3125 1016,90.3125 1016,90.3125 C1016,90.3125 1034,90.3125 1034,100.3125 L1034,126.3125 C1034,136.3125 1016,136.3125 1016,136.3125 C1016,136.3125 998,136.3125 998,126.3125 L998,100.3125 " fill="#FEFECE" filter="url(#fl2i8hobozrm8)" style="stroke:#000000;stroke-width:1.5;"/><path d="M998,100.3125 C998,110.3125 1016,110.3125 1016,110.3125 C1016,110.3125 1034,110.3125 1034,100.3125 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="983.5" y="444.2676">database</text><path d="M998,457.3438 C998,447.3438 1016,447.3438 1016,447.3438 C1016,447.3438 1034,447.3438 1034,457.3438 L1034,483.3438 C1034,493.3438 1016,493.3438 1016,493.3438 C1016,493.3438 998,493.3438 998,483.3438 L998,457.3438 " fill="#FEFECE" filter="url(#fl2i8hobozrm8)" style="stroke:#000000;stroke-width:1.5;"/><path d="M998,457.3438 C998,467.3438 1016,467.3438 1016,467.3438 C1016,467.3438 1034,467.3438 1034,457.3438 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1058.5" y="150.8457">doctor</text><ellipse cx="1081.5" cy="79.3125" fill="#FEFECE" filter="url(#fl2i8hobozrm8)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1081.5,87.3125 L1081.5,114.3125 M1068.5,95.3125 L1094.5,95.3125 M1081.5,114.3125 L1068.5,129.3125 M1081.5,114.3125 L1094.5,129.3125 " fill="none" filter="url(#fl2i8hobozrm8)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1058.5" y="444.2676">doctor</text><ellipse cx="1081.5" cy="457.3438" fill="#FEFECE" filter="url(#fl2i8hobozrm8)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1081.5,465.3438 L1081.5,492.3438 M1068.5,473.3438 L1094.5,473.3438 M1081.5,492.3438 L1068.5,507.3438 M1081.5,492.3438 L1094.5,507.3438 " fill="none" filter="url(#fl2i8hobozrm8)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#EEEEEE" filter="url(#fl2i8hobozrm8)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1109.5" x="0" y="185.0977"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1109.5" y1="185.0977" y2="185.0977"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1109.5" y1="188.0977" y2="188.0977"/><rect fill="#EEEEEE" filter="url(#fl2i8hobozrm8)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="238" x="435.75" y="173.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="224" x="441.75" y="191.417">User And Doctor ChatRoom Service</text><polygon fill="#A80036" points="87,226.625,97,230.625,87,234.625,91,230.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="22" x2="93" y1="230.625" y2="230.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="29" y="225.7686">operation</text><polygon fill="#A80036" points="508,256.9766,518,260.9766,508,264.9766,512,260.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99" x2="514" y1="260.9766" y2="260.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="397" x="106" y="256.1201">send GET request to host:/chat/{doctor}, upgrade Http to Websocket</text><polygon fill="#A80036" points="508,287.3281,518,291.3281,508,295.3281,512,291.3281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99" x2="514" y1="291.3281" y2="291.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="106" y="286.4717">send message to server use JSON format</text><polygon fill="#A80036" points="694,317.6797,704,321.6797,694,325.6797,698,321.6797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="520" x2="700" y1="321.6797" y2="321.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="527" y="316.8232">store the message to cache</text><polygon fill="#A80036" points="1004,348.0313,1014,352.0313,1004,356.0313,1008,352.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="706" x2="1010" y1="352.0313" y2="352.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="713" y="347.1748">cron task store data from cache to SQL database</text><polygon fill="#A80036" points="1069.5,378.3828,1079.5,382.3828,1069.5,386.3828,1073.5,382.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="520" x2="1075.5" y1="382.3828" y2="382.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="527" y="377.5264">message content</text><polygon fill="#A80036" points="110,408.7344,100,412.7344,110,416.7344,106,412.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="104" x2="519" y1="412.7344" y2="412.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="116" y="407.8779">message send response</text><!--MD5=[a20a6d81191b21affd2a645b7a69711b]
@startuml

skinparam titleFontSize 40
skinparam titleFontColor #black
title ChatRoom

skinparam backgroundColor #White
skinparam handwritten false

actor user
participant client
participant server
database redis
database database
actor doctor

==User And Doctor ChatRoom Service==
user -> client: operation
client -> server: send GET request to host:/chat/{doctor}, upgrade Http to Websocket
client -> server: send message to server use JSON format
server -> redis: store the message to cache
redis -> database: cron task store data from cache to SQL database
server -> doctor: message content
server -> client: message send response

@enduml

PlantUML version 1.2022.0(Wed Jan 12 00:16:42 CST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>