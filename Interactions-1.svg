<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="712px" preserveAspectRatio="none" style="width:1321px;height:712px;background:#FFFFFF;" version="1.1" viewBox="0 0 1321 712" width="1321px" zoomAndPan="magnify"><defs><filter height="300%" id="f1y0711jgw0eqo" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="40" lengthAdjust="spacing" textLength="190" x="562.25" y="53.5234">ChatRoom</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="22" x2="22" y1="153.9219" y2="626.8438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="303.5" x2="303.5" y1="153.9219" y2="626.8438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="725" x2="725" y1="153.9219" y2="626.8438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="910.5" x2="910.5" y1="153.9219" y2="626.8438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1220.5" x2="1220.5" y1="153.9219" y2="626.8438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1286.5" x2="1286.5" y1="153.9219" y2="626.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="5" y="150.8457">user</text><ellipse cx="22" cy="79.3125" fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M22,87.3125 L22,114.3125 M9,95.3125 L35,95.3125 M22,114.3125 L9,129.3125 M22,114.3125 L35,129.3125 " fill="none" filter="url(#f1y0711jgw0eqo)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="5" y="640.377">user</text><ellipse cx="22" cy="653.4531" fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M22,661.4531 L22,688.4531 M9,669.4531 L35,669.4531 M22,688.4531 L9,703.4531 M22,688.4531 L35,703.4531 " fill="none" filter="url(#f1y0711jgw0eqo)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="47" x="278.5" y="117.3125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="285.5" y="138.8457">client</text><rect fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="47" x="278.5" y="625.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="285.5" y="647.377">client</text><rect fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="54" x="696" y="117.3125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="703" y="138.8457">server</text><rect fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="54" x="696" y="625.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="703" y="647.377">server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="892.5" y="150.8457">redis</text><path d="M893,100.3125 C893,90.3125 911,90.3125 911,90.3125 C911,90.3125 929,90.3125 929,100.3125 L929,126.3125 C929,136.3125 911,136.3125 911,136.3125 C911,136.3125 893,136.3125 893,126.3125 L893,100.3125 " fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" style="stroke:#000000;stroke-width:1.5;"/><path d="M893,100.3125 C893,110.3125 911,110.3125 911,110.3125 C911,110.3125 929,110.3125 929,100.3125 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="892.5" y="640.377">redis</text><path d="M893,653.4531 C893,643.4531 911,643.4531 911,643.4531 C911,643.4531 929,643.4531 929,653.4531 L929,679.4531 C929,689.4531 911,689.4531 911,689.4531 C911,689.4531 893,689.4531 893,679.4531 L893,653.4531 " fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" style="stroke:#000000;stroke-width:1.5;"/><path d="M893,653.4531 C893,663.4531 911,663.4531 911,663.4531 C911,663.4531 929,663.4531 929,653.4531 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1188.5" y="150.8457">database</text><path d="M1203,100.3125 C1203,90.3125 1221,90.3125 1221,90.3125 C1221,90.3125 1239,90.3125 1239,100.3125 L1239,126.3125 C1239,136.3125 1221,136.3125 1221,136.3125 C1221,136.3125 1203,136.3125 1203,126.3125 L1203,100.3125 " fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1203,100.3125 C1203,110.3125 1221,110.3125 1221,110.3125 C1221,110.3125 1239,110.3125 1239,100.3125 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="1188.5" y="640.377">database</text><path d="M1203,653.4531 C1203,643.4531 1221,643.4531 1221,643.4531 C1221,643.4531 1239,643.4531 1239,653.4531 L1239,679.4531 C1239,689.4531 1221,689.4531 1221,689.4531 C1221,689.4531 1203,689.4531 1203,679.4531 L1203,653.4531 " fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1203,653.4531 C1203,663.4531 1221,663.4531 1221,663.4531 C1221,663.4531 1239,663.4531 1239,653.4531 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1263.5" y="150.8457">doctor</text><ellipse cx="1286.5" cy="79.3125" fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1286.5,87.3125 L1286.5,114.3125 M1273.5,95.3125 L1299.5,95.3125 M1286.5,114.3125 L1273.5,129.3125 M1286.5,114.3125 L1299.5,129.3125 " fill="none" filter="url(#f1y0711jgw0eqo)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1263.5" y="640.377">doctor</text><ellipse cx="1286.5" cy="653.4531" fill="#FEFECE" filter="url(#f1y0711jgw0eqo)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1286.5,661.4531 L1286.5,688.4531 M1273.5,669.4531 L1299.5,669.4531 M1286.5,688.4531 L1273.5,703.4531 M1286.5,688.4531 L1299.5,703.4531 " fill="none" filter="url(#f1y0711jgw0eqo)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#EEEEEE" filter="url(#f1y0711jgw0eqo)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1314.5" x="0" y="185.0977"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1314.5" y1="185.0977" y2="185.0977"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1314.5" y1="188.0977" y2="188.0977"/><rect fill="#EEEEEE" filter="url(#f1y0711jgw0eqo)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="134" x="590.25" y="173.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="120" x="596.25" y="191.417">User Login Service</text><polygon fill="#A80036" points="292,226.625,302,230.625,292,234.625,296,230.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="22" x2="298" y1="230.625" y2="230.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="29" y="225.7686">POST request with user name and password</text><polygon fill="#A80036" points="713,256.9766,723,260.9766,713,264.9766,717,260.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="304" x2="719" y1="260.9766" y2="260.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="311" y="256.1201">run UserLoginService</text><polygon fill="#A80036" points="1209,287.3281,1219,291.3281,1209,295.3281,1213,291.3281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="725" x2="1215" y1="291.3281" y2="291.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="732" y="286.4717">check username and password</text><polygon fill="#A80036" points="736,317.6797,726,321.6797,736,325.6797,732,321.6797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="730" x2="1220" y1="321.6797" y2="321.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="742" y="316.8232">pass check</text><polygon fill="#A80036" points="315,348.0313,305,352.0313,315,356.0313,311,352.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="309" x2="724" y1="352.0313" y2="352.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="321" y="347.1748">respense with new token</text><rect fill="#EEEEEE" filter="url(#f1y0711jgw0eqo)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1314.5" x="0" y="381.207"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1314.5" y1="381.207" y2="381.207"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1314.5" y1="384.207" y2="384.207"/><rect fill="#EEEEEE" filter="url(#f1y0711jgw0eqo)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="238" x="538.25" y="370.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="224" x="544.25" y="387.5264">User And Doctor ChatRoom Service</text><polygon fill="#A80036" points="292,422.7344,302,426.7344,292,430.7344,296,426.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="22" x2="298" y1="426.7344" y2="426.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="29" y="421.8779">operation</text><polygon fill="#A80036" points="713,453.0859,723,457.0859,713,461.0859,717,457.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="304" x2="719" y1="457.0859" y2="457.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="397" x="311" y="452.2295">send GET request to host:/chat/{doctor}, upgrade Http to Websocket</text><polygon fill="#A80036" points="713,483.4375,723,487.4375,713,491.4375,717,487.4375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="304" x2="719" y1="487.4375" y2="487.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="311" y="482.5811">send message to server use JSON format</text><polygon fill="#A80036" points="899,513.7891,909,517.7891,899,521.7891,903,517.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="725" x2="905" y1="517.7891" y2="517.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="732" y="512.9326">store the message to cache</text><polygon fill="#A80036" points="1209,544.1406,1219,548.1406,1209,552.1406,1213,548.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="911" x2="1215" y1="548.1406" y2="548.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="918" y="543.2842">cron task store data from cache to SQL database</text><polygon fill="#A80036" points="1274.5,574.4922,1284.5,578.4922,1274.5,582.4922,1278.5,578.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="725" x2="1280.5" y1="578.4922" y2="578.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="732" y="573.6357">message content</text><polygon fill="#A80036" points="315,604.8438,305,608.8438,315,612.8438,311,608.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="309" x2="724" y1="608.8438" y2="608.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="321" y="603.9873">message send response</text><!--MD5=[c6a58b8d6df69c1d7d4a04ef81a68e71]
@startuml

skinparam titleFontSize 40
skinparam titleFontColor #black
title ChatRoom

skinparam backgroundColor #White
skinparam handwritten false

actor user
participant client
participant server
database redis
database database
actor doctor

==User Login Service==
user -> client: POST request with user name and password
client -> server: run UserLoginService
server -> database: check username and password
database -> server: pass check
server -> client: respense with new token 

==User And Doctor ChatRoom Service==
user -> client: operation
client -> server: send GET request to host:/chat/{doctor}, upgrade Http to Websocket
client -> server: send message to server use JSON format
server -> redis: store the message to cache
redis -> database: cron task store data from cache to SQL database
server -> doctor: message content
server -> client: message send response


@enduml

PlantUML version 1.2022.0(Wed Jan 12 00:16:42 CST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>